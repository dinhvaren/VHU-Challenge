<div class="glitch">
  <div class="glitch__img"></div>
</div>

<!-- Navbar -->
<div class="navbar-dark text-white">
  <div class="container">
    <nav class="navbar px-0 navbar-expand-lg navbar-dark">
      <a href="/admin" class="navbar-brand">
        <h3><span class="color_danger">VHU</span><span class="color_white">Admin</span></h3>
      </a>
      <div class="navbar-nav ml-auto">
        <a href="/admin" class="p-3 text-decoration-none text-light bold">Dashboard</a>
        <a href="/hackerboard" class="p-3 text-decoration-none text-light bold">Hackerboard</a>
        <a href="/auth/logout" class="p-3 text-decoration-none text-danger bold">Logout</a>
      </div>
    </nav>
  </div>
</div>

<!-- Main -->
<div class="jumbotron bg-transparent mb-0 pt-3 radius-0">
  <div class="container">
    <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3">
        <h4 class="bold color_white mb-4">Admin Panel</h4>
        <div class="list-group">
          <a href="/admin" class="list-group-item list-group-item-action">Dashboard</a>
          <a href="/admin/leaderboard" class="list-group-item list-group-item-action">Leaderboard</a>
          <a href="/admin/users" class="list-group-item list-group-item-action">Users</a>
          <a href="/admin/teams" class="list-group-item list-group-item-action">Teams</a>
          <a href="/admin/challenges" class="list-group-item list-group-item-action active">Challenges</a>
          <a href="/admin/submissions" class="list-group-item list-group-item-action">Submissions</a>
        </div>
      </div>

      <!-- Main Table -->
      <div class="col-md-9">
        <h2 class="bold color_white mb-4">Manage Challenges</h2>

        <table class="table table-hover table-striped text-light" id="challengeTable">
          <thead class="thead-dark">
            <tr>
              <th>#</th>
              <th>Challenge</th>
              <th>Category</th>
              <th>Points</th>
              <th>Flag</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody class="hackerFont">
            <tr>
              <td>1</td>
              <td>SQL Injection</td>
              <td>Web</td>
              <td>100</td>
              <td><code>vhuCTF{sql_basic_flag}</code></td>
              <td><span class="badge badge-success">Active</span></td>
              <td>
                <button class="btn btn-sm btn-outline-primary mr-1 editBtn"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger deleteBtn"><i class="fas fa-trash"></i></button>
              </td>
            </tr>
            <tr>
              <td>2</td>
              <td>Hidden Message</td>
              <td>Crypto</td>
              <td>150</td>
              <td><code>vhuCTF{crypto_secret}</code></td>
              <td><span class="badge badge-warning">Draft</span></td>
              <td>
                <button class="btn btn-sm btn-outline-primary mr-1 editBtn"><i class="fas fa-edit"></i></button>
                <button class="btn btn-sm btn-outline-danger deleteBtn"><i class="fas fa-trash"></i></button>
              </td>
            </tr>
          </tbody>
        </table>

        <button class="btn btn-outline-danger btn-shadow px-3 my-3" data-toggle="modal" data-target="#addChallengeModal">
          <i class="fas fa-plus mr-2"></i>Add New Challenge
        </button>
      </div>
    </div>
  </div>
</div>

<!-- üü¢ Add Challenge Modal -->
<div class="modal fade" id="addChallengeModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light border border-danger">
      <div class="modal-header border-danger">
        <h5 class="modal-title color_danger bold">‚ûï Add New Challenge</h5>
        <button type="button" class="close text-light" data-dismiss="modal"><span>&times;</span></button>
      </div>
      <div class="modal-body hackerFont">
        <form id="addChallengeForm">
          <div class="form-group">
            <label>Challenge Name</label>
            <input type="text" class="form-control bg-transparent text-light" id="addName" required>
          </div>
          <div class="form-group">
            <label>Category</label>
            <select class="form-control bg-transparent text-light" id="addCategory">
              <option>Web</option>
              <option>Crypto</option>
              <option>Forensics</option>
              <option>Misc</option>
              <option>Pwn</option>
            </select>
          </div>
          <div class="form-group">
            <label>Points</label>
            <input type="number" class="form-control bg-transparent text-light" id="addPoints" value="100">
          </div>
          <div class="form-group">
            <label>Flag</label>
            <input type="text" class="form-control bg-transparent text-light" id="addFlag" placeholder="vhuCTF{example_flag}" required>
          </div>
          <div class="form-group">
            <label>Status</label>
            <select class="form-control bg-transparent text-light" id="addStatus">
              <option>Active</option>
              <option>Draft</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer border-danger">
        <button class="btn btn-outline-light" data-dismiss="modal">Cancel</button>
        <button class="btn btn-outline-danger" id="saveAdd">Add Challenge</button>
      </div>
    </div>
  </div>
</div>

<!-- üü° Edit Challenge Modal -->
<div class="modal fade" id="editChallengeModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light border border-warning">
      <div class="modal-header border-warning">
        <h5 class="modal-title color_danger bold">‚úèÔ∏è Edit Challenge</h5>
        <button type="button" class="close text-light" data-dismiss="modal"><span>&times;</span></button>
      </div>
      <div class="modal-body hackerFont">
        <form id="editChallengeForm">
          <input type="hidden" id="editRowIndex">
          <div class="form-group">
            <label>Challenge Name</label>
            <input type="text" class="form-control bg-transparent text-light" id="editName" required>
          </div>
          <div class="form-group">
            <label>Category</label>
            <select class="form-control bg-transparent text-light" id="editCategory">
              <option>Web</option>
              <option>Crypto</option>
              <option>Forensics</option>
              <option>Misc</option>
              <option>Pwn</option>
            </select>
          </div>
          <div class="form-group">
            <label>Points</label>
            <input type="number" class="form-control bg-transparent text-light" id="editPoints">
          </div>
          <div class="form-group">
            <label>Flag</label>
            <input type="text" class="form-control bg-transparent text-light" id="editFlag" placeholder="vhuCTF{updated_flag}">
          </div>
          <div class="form-group">
            <label>Status</label>
            <select class="form-control bg-transparent text-light" id="editStatus">
              <option>Active</option>
              <option>Draft</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer border-warning">
        <button class="btn btn-outline-light" data-dismiss="modal">Cancel</button>
        <button class="btn btn-outline-warning" id="saveEdit">Save Changes</button>
      </div>
    </div>
  </div>
</div>

<!-- üî¥ Delete Confirmation Modal -->
<div class="modal fade" id="deleteChallengeModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-light border border-danger">
      <div class="modal-header border-danger">
        <h5 class="modal-title color_danger bold">‚ö†Ô∏è Confirm Deletion</h5>
        <button type="button" class="close text-light" data-dismiss="modal"><span>&times;</span></button>
      </div>
      <div class="modal-body hackerFont">
        Are you sure you want to delete this challenge? This action cannot be undone.
      </div>
      <div class="modal-footer border-danger">
        <button class="btn btn-outline-light" data-dismiss="modal">Cancel</button>
        <button class="btn btn-outline-danger" id="confirmDelete">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<!-- Logic -->
<script>
  const table = document.getElementById("challengeTable").getElementsByTagName("tbody")[0];
  let deleteRow = null;

  // ADD Challenge
  $("#saveAdd").on("click", function () {
    const name = $("#addName").val();
    const cat = $("#addCategory").val();
    const pts = $("#addPoints").val();
    const flag = $("#addFlag").val();
    const status = $("#addStatus").val();

    if (!name || !flag) return alert("Please fill in all required fields.");

    const row = table.insertRow();
    const index = table.rows.length;
    row.innerHTML = `
      <td>${index}</td>
      <td>${name}</td>
      <td>${cat}</td>
      <td>${pts}</td>
      <td><code>${flag}</code></td>
      <td><span class="badge badge-${status === 'Active' ? 'success' : 'warning'}">${status}</span></td>
      <td>
        <button class="btn btn-sm btn-outline-primary mr-1 editBtn"><i class="fas fa-edit"></i></button>
        <button class="btn btn-sm btn-outline-danger deleteBtn"><i class="fas fa-trash"></i></button>
      </td>`;
    $("#addChallengeModal").modal("hide");
    $("#addChallengeForm")[0].reset();
  });

  // EDIT Challenge
  $(document).on("click", ".editBtn", function () {
    const row = $(this).closest("tr")[0];
    $("#editRowIndex").val(row.rowIndex - 1);
    $("#editName").val(row.cells[1].innerText);
    $("#editCategory").val(row.cells[2].innerText);
    $("#editPoints").val(row.cells[3].innerText);
    $("#editFlag").val(row.cells[4].innerText.replace(/`/g, ''));
    $("#editStatus").val(row.cells[5].innerText.trim());
    $("#editChallengeModal").modal("show");
  });

  $("#saveEdit").on("click", function () {
    const idx = $("#editRowIndex").val();
    const row = table.rows[idx];
    row.cells[1].innerText = $("#editName").val();
    row.cells[2].innerText = $("#editCategory").val();
    row.cells[3].innerText = $("#editPoints").val();
    row.cells[4].innerHTML = `<code>${$("#editFlag").val()}</code>`;
    const status = $("#editStatus").val();
    row.cells[5].innerHTML = `<span class="badge badge-${status === 'Active' ? 'success' : 'warning'}">${status}</span>`;
    $("#editChallengeModal").modal("hide");
  });

  // DELETE Challenge
  $(document).on("click", ".deleteBtn", function () {
    deleteRow = $(this).closest("tr")[0];
    $("#deleteChallengeModal").modal("show");
  });

  $("#confirmDelete").on("click", function () {
    if (deleteRow) deleteRow.remove();
    deleteRow = null;
    $("#deleteChallengeModal").modal("hide");
  });
</script>
